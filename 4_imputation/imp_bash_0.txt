#!/bin/bash -l

#SBATCH -A sens2019512
#SBATCH -p core
#SBATCH -n 1
#SBATCH -t 30:00
#SBATCH -J imputation
#SBATCH --mail-user=gabriel.baldanzi@medsci.uu.se
#SBATCH --mail-type=ALL


# Project - Sleep apnea and gut microbiota 

# Imputation of AHI and correlation with gut species part 1 

# This script will: 
# 1. Prepare data set for imputation  in R 
# 2. Impute the data in STATA
# 3. Calculate the q_value (FDR adjusted p-value) in R 

# Working directory 
cd /castor/project/proj_nobackup/wharf/baldanzi/baldanzi-sens2019512

# Directory where STATA is 
statadir='/proj/sens2019512/stata/'


# load R modules  
ml R_packages 

# Prepare data 
Rscript 4_imputation/pre.imputation.R

# Imputation and correlation analysis with AHI after imputation 

jid1=$(sbatch 4_imputation/imp_bash_1.txt|cut -c21-) 
jid2=$(sbatch 4_imputation/imp_bash_2.txt|cut -c21-) 
jid3=$(sbatch 4_imputation/imp_bash_3.txt|cut -c21-) 
jid4=$(sbatch 4_imputation/imp_bash_4.txt|cut -c21-) 



# Multiple testing adjustment 
sbatch --dependency=afterok:$jid1:$jid2:$jid3:$jid4 4_imputation/imp_bash_5.txt






 